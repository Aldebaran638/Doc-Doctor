# Doc-Doctor è®¾è®¡æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®åç§° | Doc-Doctor |
|---------|-----------|
| ç‰ˆæœ¬    | v0.0.1     |
| åˆ›å»ºæ—¥æœŸ | 2025-12-24 |
| æ–‡æ¡£ç±»å‹ | æŠ€æœ¯è®¾è®¡æ–‡æ¡£ (TD) |

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

Doc-Doctor æ˜¯ä¸€æ¬¾ Visual Studio Code æ‰©å±•æ’ä»¶ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨æ£€æµ‹ C/C++ é¡¹ç›®ä¸­å‡½æ•°æ³¨é‡Šçš„å®Œæ•´æ€§é—®é¢˜ã€‚é€šè¿‡é™æ€ä»£ç åˆ†æï¼Œè¯¥å·¥å…·èƒ½å¤Ÿè¯†åˆ«ç¼ºå¤±çš„å‚æ•°è¯´æ˜ã€è¿”å›å€¼è¯´æ˜ã€å‡½æ•°åŠŸèƒ½æè¿°ç­‰å¸¸è§æ–‡æ¡£é—®é¢˜ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œæ•ˆç‡ã€‚

### 1.2 é¡¹ç›®ç›®æ ‡

- è‡ªåŠ¨æ‰«æé¡¹ç›®ä¸­çš„ C/C++ æºæ–‡ä»¶ï¼Œè§£æå‡½æ•°å®šä¹‰
- æ£€æµ‹å‡½æ•°æ³¨é‡Šæ˜¯å¦ç¬¦åˆ Doxygen è§„èŒƒ
- æä¾›ç›´è§‚çš„é—®é¢˜å±•ç¤ºç•Œé¢å’Œä¸€é”®è·³è½¬åŠŸèƒ½
- æ”¯æŒçµæ´»çš„ç™½åå•é…ç½®ï¼ˆæ–‡ä»¶ã€å‡½æ•°ã€è¿”å›å€¼ç±»å‹ï¼‰
- æŒä¹…åŒ–å­˜å‚¨æ£€æŸ¥ç»“æœï¼Œæ”¯æŒè·¨ä¼šè¯æŸ¥çœ‹

### 1.3 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| å‰ç«¯ | VS Code Webview + HTML/CSS/JS | ä½¿ç”¨ VS Code Webview UI Toolkit æ„å»ºä¾§è¾¹æ ç•Œé¢ |
| æœåŠ¡å±‚ | TypeScript | æ‰©å±•æ ¸å¿ƒé€»è¾‘ï¼Œæ–‡ä»¶è§£æã€å‡½æ•°æ£€æŸ¥ã€ç™½åå•è¿‡æ»¤ |
| æ•°æ®äº¤äº’å±‚ | TypeScript + C++ (DLL) | TypeScript é€šè¿‡ koffi è°ƒç”¨ C++ åŠ¨æ€åº“ |
| æ•°æ®å­˜å‚¨ | SQLite3 | è½»é‡çº§åµŒå…¥å¼æ•°æ®åº“ï¼Œå­˜å‚¨æ£€æŸ¥ç»“æœ |
| æ„å»ºå·¥å…· | npm + CMake | TypeScript ç¼–è¯‘ + C++ åŠ¨æ€åº“æ„å»º |

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    UI[å‰ç«¯ Webview] -->|postMessage| EXT[æ‰©å±•ä¸»ä½“ Extension]
    EXT --> SERVICE[æœåŠ¡å±‚æ¨¡å—]
    SERVICE --> DB_TS[æ•°æ®åº“æ¡¥æ¥ TS]
    DB_TS -->|koffi FFI| DB_CPP[C++ DLL]
    DB_CPP --> SQLITE[(SQLite3)]
```

**æ¶æ„è¯´æ˜**ï¼š

ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼š

1. **å‰ç«¯å±‚ï¼ˆWebviewï¼‰**ï¼šåŸºäº HTML/CSS/JS å®ç°çš„ä¾§è¾¹æ ç•Œé¢ï¼Œä½¿ç”¨ VS Code Webview UI Toolkit ç»„ä»¶åº“ã€‚è´Ÿè´£ç”¨æˆ·äº¤äº’ã€é—®é¢˜åˆ—è¡¨å±•ç¤ºã€è®¾ç½®é…ç½®ç­‰ç•Œé¢åŠŸèƒ½ã€‚

2. **æ‰©å±•ä¸»ä½“ï¼ˆExtension Hostï¼‰**ï¼šTypeScript ç¼–å†™çš„ VS Code æ‰©å±•æ ¸å¿ƒï¼Œè¿è¡Œåœ¨ç‹¬ç«‹çš„ Node.js è¿›ç¨‹ä¸­ã€‚è´Ÿè´£æ¥æ”¶å‰ç«¯æ¶ˆæ¯ã€è°ƒåº¦ä¸šåŠ¡æ¨¡å—ã€ç®¡ç†æ‰©å±•ç”Ÿå‘½å‘¨æœŸã€‚

3. **æœåŠ¡å±‚æ¨¡å—**ï¼šåŒ…å«æ–‡ä»¶è§£æã€å‡½æ•°æ£€æŸ¥ã€ç™½åå•è¿‡æ»¤ã€è·³è½¬å®šä½ç­‰ä¸šåŠ¡é€»è¾‘æ¨¡å—ï¼Œå„æ¨¡å—èŒè´£å•ä¸€ã€ç›¸äº’åä½œã€‚

4. **æ•°æ®äº¤äº’å±‚**ï¼šTypeScript æ¡¥æ¥å±‚é€šè¿‡ koffi åº“ï¼ˆFFI å¤–éƒ¨å‡½æ•°æ¥å£ï¼‰è°ƒç”¨ C++ ç¼–è¯‘çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆDLLï¼‰ï¼Œå®ç°è·¨è¯­è¨€è°ƒç”¨ã€‚

5. **æ•°æ®å­˜å‚¨å±‚**ï¼šä½¿ç”¨ SQLite3 åµŒå…¥å¼æ•°æ®åº“æŒä¹…åŒ–å­˜å‚¨æ£€æŸ¥ç»“æœï¼Œæ•°æ®åº“æ–‡ä»¶ä½äºå·¥ä½œåŒº `.doc-doctor/problems.db`ã€‚

6. **é…ç½®æ–‡ä»¶**ï¼šç™½åå•ç­‰ç”¨æˆ·é…ç½®å­˜å‚¨åœ¨å·¥ä½œåŒºçš„ `.vscode/settings.json` ä¸­ï¼Œæ‰©å±•å¯åŠ¨æ—¶è‡ªåŠ¨è¯»å–å¹¶ç›‘å¬å˜æ›´ã€‚

### 2.2 åˆ†å±‚æ¶æ„è¯´æ˜

ç³»ç»Ÿé‡‡ç”¨ **ä¸‰å±‚æ¶æ„** è®¾è®¡ï¼š

| å±‚çº§ | èŒè´£ | ä¸»è¦æ¨¡å— |
|------|------|---------|
| **è¡¨ç°å±‚** | ç”¨æˆ·ç•Œé¢äº¤äº’ï¼Œç»“æœå±•ç¤º | Webview (sidebar.js) |
| **æœåŠ¡å±‚** | ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ–‡ä»¶è§£æï¼Œæ£€æŸ¥è§„åˆ™ | extension.ts, projectCheck.ts, fileCheck.ts, functionCheck.ts, fileWhiteList.ts, jumpToLocation.ts |
| **æ•°æ®å±‚** | æ•°æ®æŒä¹…åŒ–ï¼ŒSQLite æ“ä½œ | database.ts (TSæ¡¥æ¥), database.cpp (C++å®ç°) |

### 2.3 é€šä¿¡æœºåˆ¶

```mermaid
sequenceDiagram
    participant W as Webview
    participant E as Extension
    participant D as Database (C++)
    
    Note over W,E: VS Code Webview æ¶ˆæ¯é€šä¿¡
    W->>E: postMessage({type: 'runProjectCheck'})
    E->>E: æ‰«æå·¥ä½œåŒºæ–‡ä»¶
    E->>E: è§£æå‡½æ•°å®šä¹‰
    E->>E: æ£€æŸ¥æ³¨é‡Šå®Œæ•´æ€§
    E->>D: saveProblemToDB()
    D-->>E: insertedId
    E-->>W: postMessage({type: 'projectCheckResult', result})
```

**é€šä¿¡æœºåˆ¶è¯´æ˜**ï¼š

ç”±äº VS Code çš„å®‰å…¨æ¨¡å‹é™åˆ¶ï¼ŒWebview è¿è¡Œåœ¨éš”ç¦»çš„ iframe ä¸­ï¼Œæ— æ³•ç›´æ¥è®¿é—® Node.js API æˆ–æ‰©å±•ä»£ç ã€‚å› æ­¤ï¼Œå‰åç«¯é€šä¿¡å¿…é¡»é€šè¿‡ postMessage æœºåˆ¶å®ç°ï¼š

1. **å‰ç«¯å‘é€æ¶ˆæ¯**ï¼šWebview è°ƒç”¨ `vscode.postMessage({type: 'xxx', data: {...}})` å‘é€è¯·æ±‚ï¼Œæ¶ˆæ¯ç±»å‹åŒ…æ‹¬ `runProjectCheck`ï¼ˆå¯åŠ¨æ£€æŸ¥ï¼‰ã€`jumpToProblem`ï¼ˆè·³è½¬å®šä½ï¼‰ã€`saveSettings`ï¼ˆä¿å­˜è®¾ç½®ï¼‰ç­‰ã€‚

2. **åç«¯æ¥æ”¶å¤„ç†**ï¼šExtension é€šè¿‡ `webview.onDidReceiveMessage` ç›‘å¬æ¶ˆæ¯ï¼Œæ ¹æ® `type` å­—æ®µåˆ†å‘åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚

3. **åç«¯å›ä¼ ç»“æœ**ï¼šå¤„ç†å®Œæˆåï¼ŒExtension è°ƒç”¨ `webview.postMessage({type: 'xxxResult', result: {...}})` å°†ç»“æœå›ä¼ ç»™å‰ç«¯ã€‚

4. **å‰ç«¯æ¸²æŸ“æ›´æ–°**ï¼šWebview é€šè¿‡ `window.addEventListener('message', ...)` æ¥æ”¶å“åº”ï¼Œæ›´æ–°ç•Œé¢çŠ¶æ€ã€‚

è¿™ç§å¼‚æ­¥æ¶ˆæ¯é€šä¿¡æ¨¡å¼ç¡®ä¿äº†æ‰©å±•çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼ŒåŒæ—¶æ”¯æŒå¤æ‚çš„äº¤äº’åœºæ™¯ã€‚

---

## 3. æ¨¡å—è®¾è®¡

### 3.1 æ¨¡å—ä¾èµ–å…³ç³»

```mermaid
graph LR
    EXT[extension.ts] --> PC[projectCheck.ts]
    EXT --> JL[jumpToLocation.ts]
    PC --> FC[fileCheck.ts]
    PC --> FN[functionCheck.ts]
    PC --> WL[fileWhiteList.ts]
    PC --> DB[database.ts]
    DB --> DLL[C++ DLL]
```

**æ¨¡å—èŒè´£ä¸ä¾èµ–è¯´æ˜**ï¼š

1. **extension.tsï¼ˆæ‰©å±•å…¥å£ï¼‰**ï¼šä½œä¸ºæ•´ä¸ªæ‰©å±•çš„è°ƒåº¦ä¸­å¿ƒï¼Œè´Ÿè´£åˆå§‹åŒ–å„æ¨¡å—ã€æ³¨å†Œå‘½ä»¤å’Œè§†å›¾ã€åˆ†å‘ç”¨æˆ·è¯·æ±‚ã€‚å®ƒç›´æ¥ä¾èµ– `projectCheck.ts` å’Œ `jumpToLocation.ts` ä¸¤ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—ã€‚

2. **projectCheck.tsï¼ˆæ€»æ£€æŸ¥æ¨¡å—ï¼‰**ï¼šæ ¸å¿ƒä¸šåŠ¡åè°ƒè€…ï¼Œæ¥æ”¶æ£€æŸ¥è¯·æ±‚åä¾æ¬¡è°ƒç”¨ï¼š
   - `fileCheck.ts`ï¼šè§£ææºæ–‡ä»¶ï¼Œæå–å‡½æ•°ä¿¡æ¯
   - `functionCheck.ts`ï¼šæ£€æŸ¥æ¯ä¸ªå‡½æ•°çš„æ³¨é‡Šå®Œæ•´æ€§
   - `fileWhiteList.ts`ï¼šåº”ç”¨ç™½åå•è¿‡æ»¤è§„åˆ™
   - `database.ts`ï¼šå°†æ£€æŸ¥ç»“æœæŒä¹…åŒ–å­˜å‚¨

3. **jumpToLocation.tsï¼ˆè·³è½¬æ¨¡å—ï¼‰**ï¼šç‹¬ç«‹åŠŸèƒ½æ¨¡å—ï¼Œè´Ÿè´£æ ¹æ®é—®é¢˜è®°å½•çš„ä½ç½®ä¿¡æ¯æ‰“å¼€æ–‡ä»¶å¹¶å®šä½å…‰æ ‡ã€‚

4. **database.tsï¼ˆæ•°æ®åº“æ¡¥æ¥å±‚ï¼‰**ï¼šå°è£…ä¸ C++ DLL çš„äº¤äº’é€»è¾‘ï¼Œæä¾› TypeScript å‹å¥½çš„å¼‚æ­¥æ¥å£ï¼Œå†…éƒ¨é€šè¿‡ koffi åº“è°ƒç”¨åŸç”Ÿä»£ç ã€‚

è¿™ç§æ¨¡å—åŒ–è®¾è®¡éµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œä¾¿äºç‹¬ç«‹æµ‹è¯•å’Œç»´æŠ¤ã€‚

### 3.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### 3.2.1 æ‰©å±•å…¥å£æ¨¡å— (extension.ts)

**èŒè´£**ï¼š

- æ³¨å†Œ VS Code æ‰©å±•ç”Ÿå‘½å‘¨æœŸ
- åˆå§‹åŒ–ä¾§è¾¹æ  Webview Provider
- å¤„ç† Webview ä¸æ‰©å±•çš„æ¶ˆæ¯é€šä¿¡
- ç›‘å¬é…ç½®æ–‡ä»¶å˜æ›´

**å…³é”®ç±»**ï¼š
```typescript
class DocDoctorSidebarProvider implements vscode.WebviewViewProvider {
  resolveWebviewView(webviewView, context, token)  // åˆå§‹åŒ– Webview
  onConfigurationChanged()                          // é…ç½®å˜æ›´å¤„ç†
  postCurrentSettings(webview)                      // å‘é€è®¾ç½®åˆ°å‰ç«¯
}
```

#### 3.2.2 æ–‡ä»¶è§£ææ¨¡å— (fileCheck.ts)

**èŒè´£**ï¼š
- è¯»å– C/C++ æºæ–‡ä»¶å†…å®¹
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–å‡½æ•°å®šä¹‰
- æå–å‡½æ•°å‰çš„ Doxygen æ³¨é‡Šå—
- è®¡ç®—å‡½æ•°ä½ç½®ï¼ˆè¡Œå·ã€åˆ—å·ï¼‰

**æ ¸å¿ƒæ•°æ®ç»“æ„**ï¼š
```typescript
interface FunctionInfo {
  filePath: string;           // æ–‡ä»¶è·¯å¾„
  functionName: string;       // å‡½æ•°å
  functionSignature: string;  // å‡½æ•°ç­¾å
  comment: string;            // æ³¨é‡Šå†…å®¹
  functionContent: string;    // å‡½æ•°ä½“
  lineNumber: number;         // è¡Œå·
  columnNumber: number;       // åˆ—å·
}
```

**è§£ææµç¨‹**ï¼š
```mermaid
flowchart LR
    A[è¯»å–æ–‡ä»¶] --> B[æ­£åˆ™åŒ¹é…å‡½æ•°] --> C[æå–æ³¨é‡Š] --> D[æ„å»º FunctionInfo]
```

**è§£ææµç¨‹è¯´æ˜**ï¼š

1. **è¯»å–æ–‡ä»¶**ï¼šé€šè¿‡ VS Code çš„ `workspace.fs.readFile` API è¯»å–æºæ–‡ä»¶çš„ UTF-8 æ–‡æœ¬å†…å®¹ã€‚

2. **æ­£åˆ™åŒ¹é…å‡½æ•°**ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ `/([\w\s\*]+?)\s+([A-Za-z_][A-Za-z0-9_]*)\s*\([^)]*\)\s*\{/g` åŒ¹é… C/C++ å‡½æ•°å®šä¹‰ã€‚åŒæ—¶è¿‡æ»¤æ‰ `if`ã€`for`ã€`while`ã€`switch` ç­‰æ§åˆ¶è¯­å¥çš„è¯¯åŒ¹é…ã€‚

3. **æå–æ³¨é‡Š**ï¼šä»å‡½æ•°å®šä¹‰ä½ç½®å‘ä¸Šæœç´¢æœ€è¿‘çš„ `/** ... */` æˆ– `/* ... */` æ³¨é‡Šå—ï¼Œæ£€æŸ¥æ³¨é‡Šå—ä¸å‡½æ•°ä¹‹é—´æ˜¯å¦åªæœ‰ç©ºç™½å­—ç¬¦ï¼Œç¡®ä¿æ³¨é‡Šç¡®å®å±äºè¯¥å‡½æ•°ã€‚

4. **æ„å»º FunctionInfo**ï¼šè®¡ç®—å‡½æ•°ååœ¨æºç ä¸­çš„è¡Œå·å’Œåˆ—å·ï¼ˆç”¨äºåç»­è·³è½¬å®šä½ï¼‰ï¼Œç»„è£…å®Œæ•´çš„å‡½æ•°ä¿¡æ¯å¯¹è±¡ä¾›åç»­æ£€æŸ¥ä½¿ç”¨ã€‚

#### 3.2.3 å‡½æ•°æ£€æŸ¥æ¨¡å— (functionCheck.ts)

**èŒè´£**ï¼š

- æ£€æŸ¥å‡½æ•°æ³¨é‡Šæ˜¯å¦ç¬¦åˆ Doxygen è§„èŒƒ
- è¯†åˆ«ç¼ºå¤±çš„ @briefã€@paramã€@return æ ‡ç­¾
- ç”Ÿæˆé—®é¢˜æè¿°ä¿¡æ¯

**é—®é¢˜ç±»å‹æšä¸¾**ï¼š
```typescript
enum ProblemType {
  PARAM_MISSING = 1,    // å‚æ•°è¯´æ˜ç¼ºå¤±
  RETURN_MISSING = 2,   // è¿”å›å€¼è¯´æ˜ç¼ºå¤±
  BRIEF_MISSING = 3,    // å‡½æ•°ä½“è¯´æ˜ç¼ºå¤±
  CONTENT_CHANGED = 4,  // å†…å®¹å˜æ›´è­¦å‘Š
  SYNTAX_ERROR = 5,     // è¯­æ³•é”™è¯¯
}
```

**æ£€æŸ¥è§„åˆ™**ï¼š
| è§„åˆ™ | æ£€æŸ¥æ¡ä»¶ | é—®é¢˜ç±»å‹ |
|------|---------|---------|
| @brief æ£€æŸ¥ | æ³¨é‡Šä¸­æ—  @brief ä¸”æ— åŠŸèƒ½æè¿° | BRIEF_MISSING |
| @param æ£€æŸ¥ | å‡½æ•°å‚æ•°æ— å¯¹åº” @param è¯´æ˜ | PARAM_MISSING |
| @return æ£€æŸ¥ | é void å‡½æ•°æ—  @return è¯´æ˜ | RETURN_MISSING |

#### 3.2.4 æ€»æ£€æŸ¥æ¨¡å— (projectCheck.ts)

**èŒè´£**ï¼š

- æ‰«æå·¥ä½œåŒºæ‰€æœ‰ C/C++ æ–‡ä»¶
- åè°ƒæ–‡ä»¶è§£æå’Œå‡½æ•°æ£€æŸ¥
- åº”ç”¨ç™½åå•è¿‡æ»¤è§„åˆ™
- èšåˆæ£€æŸ¥ç»“æœå¹¶å­˜å…¥æ•°æ®åº“

**æ£€æŸ¥æµç¨‹**ï¼š
```mermaid
flowchart TD
    A[å¼€å§‹æ£€æŸ¥] --> B[è¯»å–é…ç½® & æŸ¥æ‰¾æ–‡ä»¶]
    B --> C[éå†æ–‡ä»¶]
    C --> D{é€šè¿‡ç™½åå•?}
    D -->|å¦| C
    D -->|æ˜¯| E[è§£æå‡½æ•°]
    E --> F[æ£€æŸ¥æ³¨é‡Š]
    F --> G[è®°å½•é—®é¢˜]
    G --> C
    C --> H[ä¿å­˜åˆ°æ•°æ®åº“]
    H --> I[è¿”å›ç»“æœ]
```

**æ£€æŸ¥æµç¨‹è¯´æ˜**ï¼š

1. **è¯»å–é…ç½®**ï¼šä» VS Code é…ç½®ä¸­è·å–ç™½åå•è§„åˆ™ï¼ŒåŒ…æ‹¬æ˜¯å¦æ£€æŸ¥ main å‡½æ•°ã€æ–‡ä»¶ç™½åå•ã€å‡½æ•°ç™½åå•ã€è¿”å›ç±»å‹ç™½åå•ã€‚

2. **æŸ¥æ‰¾æ–‡ä»¶**ï¼šä½¿ç”¨ `workspace.findFiles('**/*.{c,cpp}')` æŸ¥æ‰¾å·¥ä½œåŒºå†…æ‰€æœ‰ C/C++ æºæ–‡ä»¶ï¼Œæœ€å¤šè¿”å› 1000 ä¸ªæ–‡ä»¶ã€‚

3. **éå†æ–‡ä»¶**ï¼šå¯¹æ¯ä¸ªæ–‡ä»¶ä¾æ¬¡è¿›è¡Œä»¥ä¸‹å¤„ç†ï¼š
   - **ç™½åå•è¿‡æ»¤**ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦åŒ¹é…æ–‡ä»¶ç™½åå•å‰ç¼€ï¼ŒåŒ¹é…åˆ™è·³è¿‡
   - **å¤§å°æ£€æŸ¥**ï¼šæ–‡ä»¶è¶…è¿‡ 1MB åˆ™è·³è¿‡ï¼Œé¿å…å¤„ç†è¿‡å¤§æ–‡ä»¶
   - **è¯­æ³•é”™è¯¯æ£€æŸ¥**ï¼šé€šè¿‡ VS Code è¯Šæ–­ API è·å–æ–‡ä»¶çš„ç¼–è¯‘é”™è¯¯ï¼Œè‹¥å­˜åœ¨åˆ™è®°å½•è¯­æ³•é”™è¯¯é—®é¢˜å¹¶è·³è¿‡æ³¨é‡Šæ£€æŸ¥

4. **è§£æå‡½æ•°**ï¼šå¯¹é€šè¿‡é¢„æ£€æŸ¥çš„æ–‡ä»¶è°ƒç”¨ `fileCheck.ts` è§£ææ‰€æœ‰å‡½æ•°å®šä¹‰ã€‚

5. **æ£€æŸ¥æ³¨é‡Š**ï¼šå¯¹æ¯ä¸ªå‡½æ•°åº”ç”¨å‡½æ•°çº§ç™½åå•è¿‡æ»¤åï¼Œè°ƒç”¨ `functionCheck.ts` æ£€æŸ¥æ³¨é‡Šå®Œæ•´æ€§ã€‚

6. **è®°å½•é—®é¢˜**ï¼šå°†å‘ç°çš„é—®é¢˜æ”¶é›†åˆ°åˆ—è¡¨ä¸­ï¼Œè¾¾åˆ° 1000 æ¡ä¸Šé™æ—¶åœæ­¢æ£€æŸ¥ã€‚

7. **ä¿å­˜åˆ°æ•°æ®åº“**ï¼šæ£€æŸ¥å®Œæˆåï¼Œæ¸…ç©ºæ—§æ•°æ®å¹¶å°†æ–°é—®é¢˜æ‰¹é‡å†™å…¥ SQLite æ•°æ®åº“ã€‚

#### 3.2.5 ç™½åå•æ¨¡å— (fileWhiteList.ts)

**èŒè´£**ï¼š
- è¯»å– VS Code é…ç½®ä¸­çš„ç™½åå•è§„åˆ™
- æä¾›æ–‡ä»¶ã€å‡½æ•°ã€è¿”å›ç±»å‹çš„è¿‡æ»¤åˆ¤æ–­

**é…ç½®ç»“æ„**ï¼š
```json
{
  "doc-doctor.checkMainFunction": false,
  "doc-doctor.fileWhitelist": ["test/", "vendor/"],
  "doc-doctor.functionWhitelist": {
    "src/file.c": ["init", "cleanup"],
    "*": ["globalHelper"]
  },
  "doc-doctor.returnTypeWhitelist": ["void"]
}
```

**è¿‡æ»¤ä¼˜å…ˆçº§**ï¼š
1. main å‡½æ•°æ£€æŸ¥å¼€å…³
2. æ–‡ä»¶ç™½åå•ï¼ˆå‰ç¼€åŒ¹é…ï¼‰
3. å‡½æ•°ç™½åå•ï¼ˆæ–‡ä»¶çº§ + å…¨å±€çº§ï¼‰
4. è¿”å›å€¼ç±»å‹ç™½åå•

#### 3.2.6 è·³è½¬æ¨¡å— (jumpToLocation.ts)

**èŒè´£**ï¼š
- æ ¹æ®æ–‡ä»¶è·¯å¾„ã€è¡Œå·ã€åˆ—å·å®šä½ä»£ç ä½ç½®
- æ‰“å¼€ç›®æ ‡æ–‡ä»¶å¹¶ç§»åŠ¨å…‰æ ‡
- æ”¯æŒå‡½æ•°åæ¨¡ç³ŠåŒ¹é…å®šä½

**è·³è½¬æµç¨‹**ï¼š

```mermaid
flowchart LR
    A[æ¥æ”¶è¯·æ±‚] --> B[è§£æè·¯å¾„] --> C{æ–‡ä»¶å­˜åœ¨?}
    C -->|æ˜¯| D[æ‰“å¼€å¹¶å®šä½å…‰æ ‡]
    C -->|å¦| E[æ˜¾ç¤ºé”™è¯¯]
```

**è·³è½¬æµç¨‹è¯´æ˜**ï¼š

1. **æ¥æ”¶è¯·æ±‚**ï¼šä»å‰ç«¯æ¥æ”¶è·³è½¬è¯·æ±‚ï¼ŒåŒ…å«æ–‡ä»¶è·¯å¾„ï¼ˆfilePathï¼‰ã€è¡Œå·ï¼ˆlineNumberï¼‰ã€åˆ—å·ï¼ˆcolumnNumberï¼‰å’Œå¯é€‰çš„å‡½æ•°åï¼ˆfunctionNameï¼‰ã€‚

2. **è§£æè·¯å¾„**ï¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ï¼Œè‹¥æ˜¯ç›¸å¯¹è·¯å¾„åˆ™ä¸å·¥ä½œåŒºæ ¹ç›®å½•æ‹¼æ¥ç”Ÿæˆå®Œæ•´è·¯å¾„ã€‚

3. **æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥**ï¼šè°ƒç”¨ `workspace.fs.stat` API éªŒè¯ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™é€šè¿‡ `showErrorMessage` å¼¹å‡ºé”™è¯¯æç¤ºå¹¶ç»ˆæ­¢æµç¨‹ã€‚

4. **æ‰“å¼€æ–‡æ¡£**ï¼šè°ƒç”¨ `workspace.openTextDocument` æ‰“å¼€ç›®æ ‡æ–‡ä»¶ï¼Œå†é€šè¿‡ `window.showTextDocument` åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºã€‚

5. **å®šä½å…‰æ ‡**ï¼šè‹¥æä¾›äº†å‡½æ•°åï¼Œåˆ™åœ¨ç›®æ ‡è¡Œé™„è¿‘ï¼ˆÂ±5è¡ŒèŒƒå›´ï¼‰æœç´¢åŒ…å«è¯¥å‡½æ•°åçš„è¡Œï¼Œæé«˜å®šä½å‡†ç¡®æ€§ã€‚æœ€åè®¾ç½®å…‰æ ‡ä½ç½®å¹¶è°ƒç”¨ `revealRange` å°†ç›®æ ‡è¡Œæ»šåŠ¨åˆ°ç¼–è¾‘å™¨ä¸­å¤®ã€‚

#### 3.2.7 æ•°æ®åº“æ¨¡å— (database.ts + database.cpp)

**èŒè´£**ï¼š
- TypeScript å±‚ï¼šæä¾›å¼‚æ­¥æ¥å£ï¼Œå¤„ç† JSON åºåˆ—åŒ–
- C++ å±‚ï¼šå®é™…çš„ SQLite æ“ä½œ

**æ¥å£è®¾è®¡**ï¼š
```typescript
// TypeScript æ¡¥æ¥å±‚
function initDB(extensionUri: vscode.Uri): boolean
function saveProblemToDB(problem: ProblemInfo): Promise<SaveResult>
function loadProblemsFromDB(): Promise<LoadResult>
function updateProblemStatusInDB(id: number, status: ProblemStatus): Promise<boolean>
function clearAllProblems(): Promise<boolean>
```

```cpp
// C++ å¯¼å‡ºæ¥å£
extern "C" {
  int initDatabase(const char* dbPath);
  int saveProblem(const char* jsonInput);
  const char* loadAllProblems();
  int updateProblemStatus(int id, int status);
  int clearProblems();
  void closeDatabase();
}
```

---

## 4. æ•°æ®æµç¨‹è®¾è®¡

### 4.1 é¡¹ç›®æ£€æŸ¥æµç¨‹

```mermaid
sequenceDiagram
    actor U as ç”¨æˆ·
    participant W as Webview
    participant E as Extension
    participant DB as Database

    U->>W: ç‚¹å‡»"æ£€æŸ¥æ•´ä¸ªé¡¹ç›®"
    W->>E: postMessage(runProjectCheck)
    E->>E: æ‰«ææ–‡ä»¶ â†’ è§£æå‡½æ•° â†’ æ£€æŸ¥æ³¨é‡Š
    E->>DB: ä¿å­˜é—®é¢˜åˆ—è¡¨
    DB-->>E: ä¿å­˜æˆåŠŸ
    E-->>W: è¿”å›æ£€æŸ¥ç»“æœ
    W-->>U: æ˜¾ç¤ºé—®é¢˜åˆ—è¡¨
```

**æµç¨‹è¯¦ç»†è¯´æ˜**ï¼š

1. **ç”¨æˆ·è§¦å‘**ï¼šç”¨æˆ·åœ¨ä¾§è¾¹æ ç•Œé¢ç‚¹å‡»"æ£€æŸ¥æ•´ä¸ªé¡¹ç›®"æŒ‰é’®ï¼Œå‰ç«¯ Webview å‘é€ `runProjectCheck` ç±»å‹çš„æ¶ˆæ¯ã€‚

2. **æ‰©å±•å¤„ç†**ï¼šExtension æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œè°ƒç”¨ `runProjectCheck` å‡½æ•°å¯åŠ¨æ£€æŸ¥æµç¨‹ã€‚æ£€æŸ¥è¿‡ç¨‹ä¸­é€šè¿‡ VS Code çš„è¿›åº¦é€šçŸ¥ API æ˜¾ç¤ºå½“å‰æ­£åœ¨æ£€æŸ¥çš„æ–‡ä»¶åã€‚

3. **ä¸šåŠ¡å¤„ç†**ï¼š
   - ä½¿ç”¨ `workspace.findFiles` æŸ¥æ‰¾æ‰€æœ‰ `.c` å’Œ `.cpp` æ–‡ä»¶
   - å¯¹æ¯ä¸ªæ–‡ä»¶è¿›è¡Œç™½åå•è¿‡æ»¤ã€å¤§å°æ£€æŸ¥ã€è¯­æ³•é”™è¯¯æ£€æµ‹
   - è°ƒç”¨ `fileCheck` è§£æå‡½æ•°å®šä¹‰ï¼Œè°ƒç”¨ `functionCheck` æ£€æŸ¥æ³¨é‡Šå®Œæ•´æ€§
   - æ”¶é›†æ‰€æœ‰å‘ç°çš„é—®é¢˜åˆ°æ•°ç»„ä¸­

4. **æ•°æ®æŒä¹…åŒ–**ï¼šè°ƒç”¨ `saveProblemsToDBBatch` å…ˆæ¸…ç©ºæ—§æ•°æ®ï¼Œå†æ‰¹é‡æ’å…¥æ–°é—®é¢˜ã€‚

5. **ç»“æœè¿”å›**ï¼šå°† `CheckAllResult` å¯¹è±¡ï¼ˆåŒ…å«æ€»æ–‡ä»¶æ•°ã€å·²æ£€æŸ¥æ•°ã€è·³è¿‡æ–‡ä»¶åˆ—è¡¨ã€é—®é¢˜åˆ—è¡¨ï¼‰é€šè¿‡ `postMessage` å›ä¼ ç»™å‰ç«¯ã€‚

6. **ç•Œé¢æ›´æ–°**ï¼šå‰ç«¯æ¥æ”¶åˆ° `projectCheckResult` æ¶ˆæ¯åï¼Œæ¸²æŸ“é—®é¢˜å¡ç‰‡åˆ—è¡¨ï¼Œæ”¯æŒæŒ‰ç±»å‹ç­›é€‰å’Œå…³é”®è¯æœç´¢ã€‚

### 4.2 é—®é¢˜è·³è½¬æµç¨‹

```mermaid
sequenceDiagram
    actor U as ç”¨æˆ·
    participant W as Webview
    participant E as Extension
    participant VSC as VS Code Editor

    U->>W: ç‚¹å‡»é—®é¢˜å¡ç‰‡
    W->>E: postMessage(jumpToProblem)
    E->>VSC: æ‰“å¼€æ–‡ä»¶å¹¶å®šä½å…‰æ ‡
    VSC-->>U: æ˜¾ç¤ºç›®æ ‡ä»£ç ä½ç½®
```

**æµç¨‹è¯¦ç»†è¯´æ˜**ï¼š

1. **ç”¨æˆ·è§¦å‘**ï¼šç”¨æˆ·åœ¨é—®é¢˜å±•ç¤ºåŒºç‚¹å‡»æŸä¸ªé—®é¢˜å¡ç‰‡ï¼Œå‰ç«¯ä»é—®é¢˜å¯¹è±¡ä¸­æå– `filePath`ã€`lineNumber`ã€`columnNumber` å’Œ `functionName` å­—æ®µï¼Œå‘é€ `jumpToProblem` æ¶ˆæ¯ã€‚

2. **æ‰©å±•å¤„ç†**ï¼šExtension éªŒè¯å‚æ•°å®Œæ•´æ€§åï¼Œè°ƒç”¨ `jumpToLocation` å‡½æ•°ã€‚

3. **æ–‡ä»¶å®šä½**ï¼š
   - å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„
   - éªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆè‹¥æ–‡ä»¶è¢«åˆ é™¤åˆ™å¼¹å‡ºé”™è¯¯æç¤ºï¼‰
   - æ‰“å¼€æ–‡æ¡£å¹¶åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤º

4. **å…‰æ ‡å®šä½**ï¼š
   - è‹¥æä¾›äº†å‡½æ•°åï¼Œåœ¨ç›®æ ‡è¡Œé™„è¿‘æœç´¢ç²¾ç¡®ä½ç½®
   - å°†å…‰æ ‡ç§»åŠ¨åˆ°ç›®æ ‡è¡Œçš„é¦–ä¸ªéç©ºç™½å­—ç¬¦ä½ç½®
   - è°ƒç”¨ `revealRange` å°†ç›®æ ‡è¡Œæ»šåŠ¨åˆ°ç¼–è¾‘å™¨è§†å£ä¸­å¤®

5. **è§†è§‰åé¦ˆ**ï¼šç¼–è¾‘å™¨è‡ªåŠ¨èšç„¦åˆ°ç›®æ ‡æ–‡ä»¶å’Œä½ç½®ï¼Œç”¨æˆ·å¯ä»¥ç«‹å³å¼€å§‹ä¿®æ”¹ä»£ç ã€‚

### 4.3 è®¾ç½®ä¿å­˜æµç¨‹

```mermaid
sequenceDiagram
    actor U as ç”¨æˆ·
    participant W as Webview
    participant E as Extension

    U->>W: ä¿®æ”¹è®¾ç½®å¹¶ä¿å­˜
    W->>E: postMessage(saveSettings)
    E->>E: æ›´æ–° settings.json
    E-->>W: ä¿å­˜æˆåŠŸ
    E->>E: è‡ªåŠ¨è§¦å‘é‡æ–°æ£€æŸ¥
```

**æµç¨‹è¯¦ç»†è¯´æ˜**ï¼š

1. **ç”¨æˆ·ç¼–è¾‘**ï¼šç”¨æˆ·åœ¨è®¾ç½®é¡µé¢ä¿®æ”¹é…ç½®é¡¹ï¼ŒåŒ…æ‹¬ï¼š
   - æ˜¯å¦æ£€æŸ¥ main å‡½æ•°ï¼ˆå¤é€‰æ¡†ï¼‰
   - æ–‡ä»¶ç™½åå•ï¼ˆå¤šè¡Œæ–‡æœ¬æ¡†ï¼Œæ¯è¡Œä¸€ä¸ªè·¯å¾„å‰ç¼€ï¼‰
   - å‡½æ•°ç™½åå•ï¼ˆå¤šè¡Œæ–‡æœ¬æ¡†ï¼Œæ”¯æŒ `æ–‡ä»¶è·¯å¾„:å‡½æ•°å` æ ¼å¼ï¼‰
   - è¿”å›ç±»å‹ç™½åå•ï¼ˆå¤šè¡Œæ–‡æœ¬æ¡†ï¼Œæ¯è¡Œä¸€ä¸ªç±»å‹å¦‚ `void`ï¼‰

2. **å‰ç«¯æ”¶é›†**ï¼šç‚¹å‡»"ä¿å­˜è®¾ç½®"æŒ‰é’®åï¼Œå‰ç«¯å°†è¡¨å•æ•°æ®åºåˆ—åŒ–ä¸ºå¯¹è±¡ï¼Œå‘é€ `saveSettings` æ¶ˆæ¯ã€‚

3. **é…ç½®å†™å…¥**ï¼šExtension è§£ææ¥æ”¶åˆ°çš„æ•°æ®ï¼Œè°ƒç”¨ `workspace.getConfiguration('doc-doctor')` è·å–é…ç½®å¯¹è±¡ï¼Œä¾æ¬¡è°ƒç”¨ `config.update()` æ–¹æ³•å°†å„é¡¹é…ç½®å†™å…¥å·¥ä½œåŒºçš„ `.vscode/settings.json` æ–‡ä»¶ã€‚

4. **åé¦ˆé€šçŸ¥**ï¼šå†™å…¥æˆåŠŸåé€šè¿‡ `showInformationMessage` æ˜¾ç¤º"è®¾ç½®å·²ä¿å­˜"æç¤ºï¼Œå¹¶å‘å‰ç«¯å‘é€ `settingsSaved` æ¶ˆæ¯æ›´æ–°ç•Œé¢çŠ¶æ€ã€‚

5. **è‡ªåŠ¨é‡æ£€**ï¼šä¿å­˜å®Œæˆåè‡ªåŠ¨è°ƒç”¨ `runProjectCheck` é‡æ–°æ‰§è¡Œé¡¹ç›®æ£€æŸ¥ï¼Œç¡®ä¿æ–°é…ç½®ç«‹å³ç”Ÿæ•ˆã€‚ç”¨æˆ·æ— éœ€æ‰‹åŠ¨ç‚¹å‡»æ£€æŸ¥æŒ‰é’®ã€‚

6. **é…ç½®ç›‘å¬**ï¼šExtension è¿˜æ³¨å†Œäº† `onDidChangeConfiguration` ç›‘å¬å™¨ï¼Œè‹¥ç”¨æˆ·ç›´æ¥ç¼–è¾‘ `settings.json` æ–‡ä»¶ï¼Œä¹Ÿèƒ½è‡ªåŠ¨æ„ŸçŸ¥å¹¶åŒæ­¥åˆ°å‰ç«¯ç•Œé¢ã€‚

---

## 5. æ•°æ®ç»“æ„è®¾è®¡

### 5.1 æ•°æ®åº“è¡¨ç»“æ„

**problems è¡¨**ï¼š

```sql
CREATE TABLE IF NOT EXISTS problems (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    problem_type INTEGER NOT NULL,
    file_path TEXT NOT NULL,
    function_signature TEXT,
    function_name TEXT NOT NULL,
    line_number INTEGER DEFAULT 1,
    column_number INTEGER DEFAULT 1,
    problem_description TEXT,
    function_snippet TEXT,
    check_timestamp TEXT NOT NULL,
    status INTEGER DEFAULT 0
);
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | é—®é¢˜å”¯ä¸€æ ‡è¯† |
| problem_type | INTEGER | NOT NULL | é—®é¢˜ç±»å‹ (1-5) |
| file_path | TEXT | NOT NULL | æ–‡ä»¶ç›¸å¯¹è·¯å¾„ |
| function_signature | TEXT | | å‡½æ•°ç­¾å |
| function_name | TEXT | NOT NULL | å‡½æ•°å |
| line_number | INTEGER | DEFAULT 1 | å‡½æ•°æ‰€åœ¨è¡Œå· |
| column_number | INTEGER | DEFAULT 1 | å‡½æ•°åæ‰€åœ¨åˆ—å· |
| problem_description | TEXT | | é—®é¢˜æè¿° |
| function_snippet | TEXT | | å‡½æ•°ä»£ç ç‰‡æ®µ |
| check_timestamp | TEXT | NOT NULL | æ£€æŸ¥æ—¶é—´ (ISO 8601) |
| status | INTEGER | DEFAULT 0 | çŠ¶æ€: 0=æ­£å¸¸, 1=å·²å®Œæˆ |

### 5.2 æ ¸å¿ƒç±»å‹å®šä¹‰

```typescript
// å‡½æ•°ä¿¡æ¯
interface FunctionInfo {
  filePath: string;
  functionName: string;
  functionSignature: string;
  comment: string;
  functionContent: string;
  lineNumber: number;
  columnNumber: number;
}

// é—®é¢˜ä¿¡æ¯
interface ProblemInfo {
  problemType: ProblemType;
  filePath: string;
  functionName: string;
  functionSignature: string;
  lineNumber: number;
  columnNumber: number;
  problemDescription: string;
  functionSnippet: string;
}

// æ•°æ®åº“è®°å½•ï¼ˆæ‰©å±• ProblemInfoï¼‰
interface ProblemRecord extends ProblemInfo {
  id: number;
  checkTimestamp: string;
  status: ProblemStatus;
}

// æ£€æŸ¥ç»“æœ
interface CheckAllResult {
  success: boolean;
  totalFiles: number;
  checkedFiles: number;
  skippedFiles: string[];
  problems: ProblemInfo[];
  errorMessage?: string;
}

// ç™½åå•é…ç½®
interface DocDoctorSettings {
  checkMainFunction: boolean;
  functionWhitelist: Record<string, string[]>;
  fileWhitelist: string[];
  returnTypeWhitelist: string[];
}
```

---

## 6. å‰ç«¯ç•Œé¢è®¾è®¡

### 6.1 ç•Œé¢ç»“æ„

ä¾§è¾¹æ é‡‡ç”¨ **Tab é¢æ¿** å¸ƒå±€ï¼ŒåŒ…å«ä¸‰ä¸ªæ ‡ç­¾é¡µï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æ£€æŸ¥]  [è®¾ç½®]  [è°ƒè¯•]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  (å½“å‰é€‰ä¸­æ ‡ç­¾é¡µçš„å†…å®¹)                â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å‡ºæ—¥å¿—                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚  (æ—¥å¿—å†…å®¹åŒºåŸŸ)                       â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ£€æŸ¥é¡µè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¸å¿ƒæ£€æŸ¥                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚æ£€æŸ¥å•ä¸ªæ–‡ä»¶   â”‚ â”‚ æ£€æŸ¥æ•´ä¸ªé¡¹ç›®      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é—®é¢˜å±•ç¤ºåŒº                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” æœç´¢æ–‡ä»¶/å‡½æ•°...â”‚ â”‚ æ‰€æœ‰ç±»å‹ â–¼ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ add  @ è¡Œ 25          å‚æ•°ç¼ºå¤± â”‚â”‚
â”‚  â”‚ src/math.c : 5                  â”‚â”‚
â”‚  â”‚ ç¼ºå°‘å‚æ•° "a" çš„è¯´æ˜               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ calculate  @ è¡Œ 42   è¿”å›å€¼ç¼ºå¤±â”‚â”‚
â”‚  â”‚ src/utils.c : 8                  â”‚â”‚
â”‚  â”‚ ç¼ºå°‘ @return è¯´æ˜                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 é—®é¢˜å¡ç‰‡äº¤äº’

- **ç‚¹å‡»å¡ç‰‡**ï¼šè·³è½¬åˆ°å¯¹åº”å‡½æ•°ä½ç½®
- **ç‚¹å‡»æ ‡è®°æŒ‰é’® (â—‹/âœ“)**ï¼šåˆ‡æ¢å®ŒæˆçŠ¶æ€
- **å·²å®Œæˆé—®é¢˜**ï¼šç½®åº•æ˜¾ç¤ºï¼Œé€æ˜åº¦é™ä½

### 6.4 è®¾ç½®é¡µè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æŸ¥è§„åˆ™                            â”‚
â”‚  â˜ æ£€æŸ¥ main å‡½æ•°                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡ä»¶ç™½åå•                          â”‚
â”‚  (æ¯è¡Œä¸€ä¸ªè·¯å¾„ï¼Œæ”¯æŒç›®å½•)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ test/                            â”‚â”‚
â”‚  â”‚ vendor/                          â”‚â”‚
â”‚  â”‚ src/legacy/                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‡½æ•°ç™½åå•                          â”‚
â”‚  (æ¯è¡Œä¸€ä¸ªå‡½æ•°å)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ init                             â”‚â”‚
â”‚  â”‚ cleanup                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿”å›å€¼ç±»å‹ç™½åå•                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ void                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         ä¿å­˜è®¾ç½®                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5 Webview æ¶ˆæ¯ç±»å‹

| æ¶ˆæ¯ç±»å‹ | æ–¹å‘ | è¯´æ˜ |
|---------|------|------|
| `runSingleFileCheck` | Webview â†’ Extension | è§¦å‘å•æ–‡ä»¶æ£€æŸ¥ |
| `runProjectCheck` | Webview â†’ Extension | è§¦å‘é¡¹ç›®æ£€æŸ¥ |
| `jumpToProblem` | Webview â†’ Extension | è·³è½¬åˆ°é—®é¢˜ä½ç½® |
| `saveSettings` | Webview â†’ Extension | ä¿å­˜è®¾ç½® |
| `updateProblemStatus` | Webview â†’ Extension | æ›´æ–°é—®é¢˜çŠ¶æ€ |
| `cancelCheck` | Webview â†’ Extension | å–æ¶ˆæ£€æŸ¥ |
| `requestSettings` | Webview â†’ Extension | è¯·æ±‚å½“å‰è®¾ç½® |
| `projectCheckResult` | Extension â†’ Webview | æ£€æŸ¥ç»“æœ |
| `databaseLoadResult` | Extension â†’ Webview | æ•°æ®åº“è¯»å–ç»“æœ |
| `initSettings` | Extension â†’ Webview | åˆå§‹åŒ–è®¾ç½®æ•°æ® |
| `settingsSaved` | Extension â†’ Webview | è®¾ç½®ä¿å­˜ç»“æœ |
| `log` | Extension â†’ Webview | æ—¥å¿—è¾“å‡º |

---

## 7. æ¥å£è®¾è®¡æ¦‚è¿°

> è¯¦ç»†æ¥å£æ–‡æ¡£è¯·å‚é˜… [æ¥å£æ–‡æ¡£.md](./æ¥å£æ–‡æ¡£.md)

### 7.1 æœåŠ¡å±‚æ¥å£æ¦‚è§ˆ

| æ¨¡å— | ä¸»è¦æ¥å£ | è¯´æ˜ |
|------|---------|------|
| æ–‡ä»¶è§£ææ¨¡å— | `checkFile(uri)` | è§£æå•ä¸ª C/C++ æ–‡ä»¶ |
| å‡½æ•°æ£€æŸ¥æ¨¡å— | `checkFunction(funcInfo)` | æ£€æŸ¥å•ä¸ªå‡½æ•°æ³¨é‡Š |
| æ€»æ£€æŸ¥æ¨¡å— | `checkAllFiles(callback)` | æ£€æŸ¥æ•´ä¸ªå·¥ä½œåŒº |
| ç™½åå•æ¨¡å— | `shouldSkipFunction(func, settings)` | åˆ¤æ–­å‡½æ•°æ˜¯å¦è·³è¿‡ |
| è·³è½¬æ¨¡å— | `jumpToLocation(path, line, col)` | è·³è½¬åˆ°æŒ‡å®šä½ç½® |

### 7.2 æ•°æ®å±‚æ¥å£æ¦‚è§ˆ

| å±‚çº§ | æ¥å£ | è¯´æ˜ |
|------|-----|------|
| TS æ¡¥æ¥å±‚ | `saveProblemToDB()` | å­˜å‚¨é—®é¢˜ |
| TS æ¡¥æ¥å±‚ | `loadProblemsFromDB()` | è¯»å–é—®é¢˜ |
| TS æ¡¥æ¥å±‚ | `updateProblemStatusInDB()` | æ›´æ–°çŠ¶æ€ |
| C++ DLL | `saveProblem()` | SQLite æ’å…¥ |
| C++ DLL | `loadAllProblems()` | SQLite æŸ¥è¯¢ |
| C++ DLL | `updateProblemStatus()` | SQLite æ›´æ–° |

---

## 8. éƒ¨ç½²ä¸æ„å»º

### 8.1 ç›®å½•ç»“æ„

```
doc-doctor/
â”œâ”€â”€ media/                    # å‰ç«¯èµ„æº
â”‚   â”œâ”€â”€ icon.svg              # æ‰©å±•å›¾æ ‡
â”‚   â”œâ”€â”€ sidebar.js            # Webview è„šæœ¬
â”‚   â””â”€â”€ toolkit.js            # UI Toolkit
â”œâ”€â”€ native/                   # C++ åŸç”Ÿæ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ database.cpp      # æ•°æ®åº“å®ç°
â”‚   â”‚   â”œâ”€â”€ database.h        # å¤´æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ main.cpp          # å…¥å£ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ build/                # CMake æ„å»ºäº§ç‰©
â”‚   â”‚   â””â”€â”€ Release/
â”‚   â”‚       â””â”€â”€ doc_doctor_db.dll
â”‚   â”œâ”€â”€ CMakeLists.txt        # CMake é…ç½®
â”‚   â””â”€â”€ CMakePresets.json     # CMake é¢„è®¾
â”œâ”€â”€ src/                      # TypeScript æºç 
â”‚   â”œâ”€â”€ extension.ts          # æ‰©å±•å…¥å£
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ database.ts       # æ•°æ®åº“æ¡¥æ¥
â”‚   â”‚   â”œâ”€â”€ fileCheck.ts      # æ–‡ä»¶è§£æ
â”‚   â”‚   â”œâ”€â”€ fileWhiteList.ts  # ç™½åå•
â”‚   â”‚   â”œâ”€â”€ functionCheck.ts  # å‡½æ•°æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ jumpToLocation.ts # è·³è½¬
â”‚   â”‚   â””â”€â”€ projectCheck.ts   # æ€»æ£€æŸ¥
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ getAddress.ts
â”‚       â””â”€â”€ getDiff.ts
â”œâ”€â”€ out/                      # TypeScript ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ package.json              # npm é…ç½®
â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
â””â”€â”€ README.md
```

### 8.2 æ„å»ºæ­¥éª¤

#### 8.2.1 TypeScript ç¼–è¯‘

```bash
cd doc-doctor
npm install
npm run compile
```

#### 8.2.2 C++ åŠ¨æ€åº“æ„å»º (Windows)

```bash
cd doc-doctor/native

# ä½¿ç”¨ CMake é…ç½®
cmake -B build -S . --preset=default

# ç¼–è¯‘ Release ç‰ˆæœ¬
cmake --build build --config Release
```

**ä¾èµ–é¡¹**ï¼š
- SQLite3 (sqlite3.dll)
- nlohmann/json (å¤´æ–‡ä»¶åº“)

#### 8.2.3 æ‰©å±•æ‰“åŒ…

```bash
npm install -g @vscode/vsce
vsce package
```

### 8.3 è¿è¡Œæ—¶æ–‡ä»¶

æ‰©å±•è¿è¡Œæ—¶ä¼šåœ¨å·¥ä½œåŒºåˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

```
<workspace>/
â””â”€â”€ .doc-doctor/
    â””â”€â”€ problems.db    # SQLite æ•°æ®åº“æ–‡ä»¶
```

### 8.4 é…ç½®é¡¹

åœ¨ `.vscode/settings.json` ä¸­é…ç½®ï¼š

```json
{
  "doc-doctor.checkMainFunction": false,
  "doc-doctor.fileWhitelist": [
    "test/",
    "vendor/"
  ],
  "doc-doctor.functionWhitelist": {
    "src/legacy.c": ["oldFunction"],
    "*": ["globalHelper"]
  },
  "doc-doctor.returnTypeWhitelist": ["void"]
}
```

---

## é™„å½• A: é—®é¢˜ç±»å‹æ˜ å°„

| ç¼–å· | ç±»å‹ | æè¿° | æ£€æŸ¥è§„åˆ™ |
|------|------|------|---------|
| 1 | PARAM_MISSING | å‚æ•°è¯´æ˜ç¼ºå¤± | å‡½æ•°å‚æ•°æ— å¯¹åº” @param |
| 2 | RETURN_MISSING | è¿”å›å€¼è¯´æ˜ç¼ºå¤± | é void å‡½æ•°æ—  @return |
| 3 | BRIEF_MISSING | å‡½æ•°ä½“è¯´æ˜ç¼ºå¤± | æ—  @brief æˆ–åŠŸèƒ½æè¿° |
| 4 | CONTENT_CHANGED | å†…å®¹å˜æ›´è­¦å‘Š | å‡½æ•°ä½“å˜æ›´æœªæ›´æ–°æ³¨é‡Š |
| 5 | SYNTAX_ERROR | è¯­æ³•é”™è¯¯ | æ–‡ä»¶å­˜åœ¨ç¼–è¯‘é”™è¯¯ |

---

## é™„å½• B: Doxygen æ³¨é‡Šè§„èŒƒ

**æ ‡å‡†æ ¼å¼**ï¼š

```c
/**
 * @brief å‡½æ•°åŠŸèƒ½æè¿°
 * @param param1 å‚æ•°1çš„è¯´æ˜
 * @param param2 å‚æ•°2çš„è¯´æ˜
 * @return è¿”å›å€¼çš„è¯´æ˜
 */
int exampleFunction(int param1, char* param2) {
    // å‡½æ•°å®ç°
    return 0;
}
```

**æ£€æŸ¥è¦ç‚¹**ï¼š
- `@brief` æˆ–é¦–è¡Œæè¿°ä¸èƒ½ä¸ºç©º
- æ¯ä¸ªå‚æ•°å¿…é¡»æœ‰å¯¹åº”çš„ `@param` è¯´æ˜
- è¿”å›å€¼é void æ—¶å¿…é¡»æœ‰ `@return` è¯´æ˜
