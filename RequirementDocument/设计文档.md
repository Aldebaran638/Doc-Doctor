# Doc-Doctor è®¾è®¡æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®åç§° | Doc-Doctor |
|---------|-----------|
| ç‰ˆæœ¬    | v0.0.1     |
| åˆ›å»ºæ—¥æœŸ | 2025-12-24 |
| æ–‡æ¡£ç±»å‹ | æŠ€æœ¯è®¾è®¡æ–‡æ¡£ (TD) |

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

Doc-Doctor æ˜¯ä¸€æ¬¾ Visual Studio Code æ‰©å±•æ’ä»¶ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨æ£€æµ‹ C/C++ é¡¹ç›®ä¸­å‡½æ•°æ³¨é‡Šçš„å®Œæ•´æ€§é—®é¢˜ã€‚é€šè¿‡é™æ€ä»£ç åˆ†æï¼Œè¯¥å·¥å…·èƒ½å¤Ÿè¯†åˆ«ç¼ºå¤±çš„å‚æ•°è¯´æ˜ã€è¿”å›å€¼è¯´æ˜ã€å‡½æ•°åŠŸèƒ½æè¿°ç­‰å¸¸è§æ–‡æ¡£é—®é¢˜ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œæ•ˆç‡ã€‚

### 1.2 é¡¹ç›®ç›®æ ‡

- è‡ªåŠ¨æ‰«æé¡¹ç›®ä¸­çš„ C/C++ æºæ–‡ä»¶ï¼Œè§£æå‡½æ•°å®šä¹‰
- æ£€æµ‹å‡½æ•°æ³¨é‡Šæ˜¯å¦ç¬¦åˆ Doxygen è§„èŒƒ
- æä¾›ç›´è§‚çš„é—®é¢˜å±•ç¤ºç•Œé¢å’Œä¸€é”®è·³è½¬åŠŸèƒ½
- æ”¯æŒçµæ´»çš„ç™½åå•é…ç½®ï¼ˆæ–‡ä»¶ã€å‡½æ•°ã€è¿”å›å€¼ç±»å‹ï¼‰
- æŒä¹…åŒ–å­˜å‚¨æ£€æŸ¥ç»“æœï¼Œæ”¯æŒè·¨ä¼šè¯æŸ¥çœ‹

### 1.3 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| å‰ç«¯ | VS Code Webview + HTML/CSS/JS | ä½¿ç”¨ VS Code Webview UI Toolkit æ„å»ºä¾§è¾¹æ ç•Œé¢ |
| æœåŠ¡å±‚ | TypeScript | æ‰©å±•æ ¸å¿ƒé€»è¾‘ï¼Œæ–‡ä»¶è§£æã€å‡½æ•°æ£€æŸ¥ã€ç™½åå•è¿‡æ»¤ |
| æ•°æ®äº¤äº’å±‚ | TypeScript + C++ (DLL) | TypeScript é€šè¿‡ koffi è°ƒç”¨ C++ åŠ¨æ€åº“ |
| æ•°æ®å­˜å‚¨ | SQLite3 | è½»é‡çº§åµŒå…¥å¼æ•°æ®åº“ï¼Œå­˜å‚¨æ£€æŸ¥ç»“æœ |
| æ„å»ºå·¥å…· | npm + CMake | TypeScript ç¼–è¯‘ + C++ åŠ¨æ€åº“æ„å»º |

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    UI[å‰ç«¯ Webview] -->|postMessage| EXT[æ‰©å±•ä¸»ä½“ Extension]
    EXT --> SERVICE[æœåŠ¡å±‚æ¨¡å—]
    SERVICE --> DB_TS[æ•°æ®åº“æ¡¥æ¥ TS]
    DB_TS -->|koffi FFI| DB_CPP[C++ DLL]
    DB_CPP --> SQLITE[(SQLite3)]
    EXT -.->|è¯»å–| SETTINGS[settings.json]
```

### 2.2 åˆ†å±‚æ¶æ„è¯´æ˜

ç³»ç»Ÿé‡‡ç”¨ **ä¸‰å±‚æ¶æ„** è®¾è®¡ï¼š

| å±‚çº§ | èŒè´£ | ä¸»è¦æ¨¡å— |
|------|------|---------|
| **è¡¨ç°å±‚** | ç”¨æˆ·ç•Œé¢äº¤äº’ï¼Œç»“æœå±•ç¤º | Webview (sidebar.js) |
| **æœåŠ¡å±‚** | ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ–‡ä»¶è§£æï¼Œæ£€æŸ¥è§„åˆ™ | extension.ts, projectCheck.ts, fileCheck.ts, functionCheck.ts, fileWhiteList.ts, jumpToLocation.ts |
| **æ•°æ®å±‚** | æ•°æ®æŒä¹…åŒ–ï¼ŒSQLite æ“ä½œ | database.ts (TSæ¡¥æ¥), database.cpp (C++å®ç°) |

### 2.3 é€šä¿¡æœºåˆ¶

```mermaid
sequenceDiagram
    participant W as Webview
    participant E as Extension
    participant D as Database (C++)
    
    Note over W,E: VS Code Webview æ¶ˆæ¯é€šä¿¡
    W->>E: postMessage({type: 'runProjectCheck'})
    E->>E: æ‰«æå·¥ä½œåŒºæ–‡ä»¶
    E->>E: è§£æå‡½æ•°å®šä¹‰
    E->>E: æ£€æŸ¥æ³¨é‡Šå®Œæ•´æ€§
    E->>D: saveProblemToDB()
    D-->>E: insertedId
    E-->>W: postMessage({type: 'projectCheckResult', result})
```

---

## 3. æ¨¡å—è®¾è®¡

### 3.1 æ¨¡å—ä¾èµ–å…³ç³»

```mermaid
graph LR
    EXT[extension.ts] --> PC[projectCheck.ts]
    EXT --> JL[jumpToLocation.ts]
    PC --> FC[fileCheck.ts]
    PC --> FN[functionCheck.ts]
    PC --> WL[fileWhiteList.ts]
    PC --> DB[database.ts]
    DB --> DLL[C++ DLL]
```

### 3.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### 3.2.1 æ‰©å±•å…¥å£æ¨¡å— (extension.ts)

**èŒè´£**ï¼š
- æ³¨å†Œ VS Code æ‰©å±•ç”Ÿå‘½å‘¨æœŸ
- åˆå§‹åŒ–ä¾§è¾¹æ  Webview Provider
- å¤„ç† Webview ä¸æ‰©å±•çš„æ¶ˆæ¯é€šä¿¡
- ç›‘å¬é…ç½®æ–‡ä»¶å˜æ›´

**å…³é”®ç±»**ï¼š
```typescript
class DocDoctorSidebarProvider implements vscode.WebviewViewProvider {
  resolveWebviewView(webviewView, context, token)  // åˆå§‹åŒ– Webview
  onConfigurationChanged()                          // é…ç½®å˜æ›´å¤„ç†
  postCurrentSettings(webview)                      // å‘é€è®¾ç½®åˆ°å‰ç«¯
}
```

#### 3.2.2 æ–‡ä»¶è§£ææ¨¡å— (fileCheck.ts)

**èŒè´£**ï¼š
- è¯»å– C/C++ æºæ–‡ä»¶å†…å®¹
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–å‡½æ•°å®šä¹‰
- æå–å‡½æ•°å‰çš„ Doxygen æ³¨é‡Šå—
- è®¡ç®—å‡½æ•°ä½ç½®ï¼ˆè¡Œå·ã€åˆ—å·ï¼‰

**æ ¸å¿ƒæ•°æ®ç»“æ„**ï¼š
```typescript
interface FunctionInfo {
  filePath: string;           // æ–‡ä»¶è·¯å¾„
  functionName: string;       // å‡½æ•°å
  functionSignature: string;  // å‡½æ•°ç­¾å
  comment: string;            // æ³¨é‡Šå†…å®¹
  functionContent: string;    // å‡½æ•°ä½“
  lineNumber: number;         // è¡Œå·
  columnNumber: number;       // åˆ—å·
}
```

**è§£ææµç¨‹**ï¼š
```mermaid
flowchart LR
    A[è¯»å–æ–‡ä»¶] --> B[æ­£åˆ™åŒ¹é…å‡½æ•°] --> C[æå–æ³¨é‡Š] --> D[æ„å»º FunctionInfo]
```

#### 3.2.3 å‡½æ•°æ£€æŸ¥æ¨¡å— (functionCheck.ts)

**èŒè´£**ï¼š
- æ£€æŸ¥å‡½æ•°æ³¨é‡Šæ˜¯å¦ç¬¦åˆ Doxygen è§„èŒƒ
- è¯†åˆ«ç¼ºå¤±çš„ @briefã€@paramã€@return æ ‡ç­¾
- ç”Ÿæˆé—®é¢˜æè¿°ä¿¡æ¯

**é—®é¢˜ç±»å‹æšä¸¾**ï¼š
```typescript
enum ProblemType {
  PARAM_MISSING = 1,    // å‚æ•°è¯´æ˜ç¼ºå¤±
  RETURN_MISSING = 2,   // è¿”å›å€¼è¯´æ˜ç¼ºå¤±
  BRIEF_MISSING = 3,    // å‡½æ•°ä½“è¯´æ˜ç¼ºå¤±
  CONTENT_CHANGED = 4,  // å†…å®¹å˜æ›´è­¦å‘Š
  SYNTAX_ERROR = 5,     // è¯­æ³•é”™è¯¯
}
```

**æ£€æŸ¥è§„åˆ™**ï¼š
| è§„åˆ™ | æ£€æŸ¥æ¡ä»¶ | é—®é¢˜ç±»å‹ |
|------|---------|---------|
| @brief æ£€æŸ¥ | æ³¨é‡Šä¸­æ—  @brief ä¸”æ— åŠŸèƒ½æè¿° | BRIEF_MISSING |
| @param æ£€æŸ¥ | å‡½æ•°å‚æ•°æ— å¯¹åº” @param è¯´æ˜ | PARAM_MISSING |
| @return æ£€æŸ¥ | é void å‡½æ•°æ—  @return è¯´æ˜ | RETURN_MISSING |

#### 3.2.4 æ€»æ£€æŸ¥æ¨¡å— (projectCheck.ts)

**èŒè´£**ï¼š
- æ‰«æå·¥ä½œåŒºæ‰€æœ‰ C/C++ æ–‡ä»¶
- åè°ƒæ–‡ä»¶è§£æå’Œå‡½æ•°æ£€æŸ¥
- åº”ç”¨ç™½åå•è¿‡æ»¤è§„åˆ™
- èšåˆæ£€æŸ¥ç»“æœå¹¶å­˜å…¥æ•°æ®åº“

**æ£€æŸ¥æµç¨‹**ï¼š
```mermaid
flowchart TD
    A[å¼€å§‹æ£€æŸ¥] --> B[è¯»å–é…ç½® & æŸ¥æ‰¾æ–‡ä»¶]
    B --> C[éå†æ–‡ä»¶]
    C --> D{é€šè¿‡ç™½åå•?}
    D -->|å¦| C
    D -->|æ˜¯| E[è§£æå‡½æ•°]
    E --> F[æ£€æŸ¥æ³¨é‡Š]
    F --> G[è®°å½•é—®é¢˜]
    G --> C
    C --> H[ä¿å­˜åˆ°æ•°æ®åº“]
    H --> I[è¿”å›ç»“æœ]
```

#### 3.2.5 ç™½åå•æ¨¡å— (fileWhiteList.ts)

**èŒè´£**ï¼š
- è¯»å– VS Code é…ç½®ä¸­çš„ç™½åå•è§„åˆ™
- æä¾›æ–‡ä»¶ã€å‡½æ•°ã€è¿”å›ç±»å‹çš„è¿‡æ»¤åˆ¤æ–­

**é…ç½®ç»“æ„**ï¼š
```json
{
  "doc-doctor.checkMainFunction": false,
  "doc-doctor.fileWhitelist": ["test/", "vendor/"],
  "doc-doctor.functionWhitelist": {
    "src/file.c": ["init", "cleanup"],
    "*": ["globalHelper"]
  },
  "doc-doctor.returnTypeWhitelist": ["void"]
}
```

**è¿‡æ»¤ä¼˜å…ˆçº§**ï¼š
1. main å‡½æ•°æ£€æŸ¥å¼€å…³
2. æ–‡ä»¶ç™½åå•ï¼ˆå‰ç¼€åŒ¹é…ï¼‰
3. å‡½æ•°ç™½åå•ï¼ˆæ–‡ä»¶çº§ + å…¨å±€çº§ï¼‰
4. è¿”å›å€¼ç±»å‹ç™½åå•

#### 3.2.6 è·³è½¬æ¨¡å— (jumpToLocation.ts)

**èŒè´£**ï¼š
- æ ¹æ®æ–‡ä»¶è·¯å¾„ã€è¡Œå·ã€åˆ—å·å®šä½ä»£ç ä½ç½®
- æ‰“å¼€ç›®æ ‡æ–‡ä»¶å¹¶ç§»åŠ¨å…‰æ ‡
- æ”¯æŒå‡½æ•°åæ¨¡ç³ŠåŒ¹é…å®šä½

**è·³è½¬æµç¨‹**ï¼š
```mermaid
flowchart LR
    A[æ¥æ”¶è¯·æ±‚] --> B[è§£æè·¯å¾„] --> C{æ–‡ä»¶å­˜åœ¨?}
    C -->|æ˜¯| D[æ‰“å¼€å¹¶å®šä½å…‰æ ‡]
    C -->|å¦| E[æ˜¾ç¤ºé”™è¯¯]
```

#### 3.2.7 æ•°æ®åº“æ¨¡å— (database.ts + database.cpp)

**èŒè´£**ï¼š
- TypeScript å±‚ï¼šæä¾›å¼‚æ­¥æ¥å£ï¼Œå¤„ç† JSON åºåˆ—åŒ–
- C++ å±‚ï¼šå®é™…çš„ SQLite æ“ä½œ

**æ¥å£è®¾è®¡**ï¼š
```typescript
// TypeScript æ¡¥æ¥å±‚
function initDB(extensionUri: vscode.Uri): boolean
function saveProblemToDB(problem: ProblemInfo): Promise<SaveResult>
function loadProblemsFromDB(): Promise<LoadResult>
function updateProblemStatusInDB(id: number, status: ProblemStatus): Promise<boolean>
function clearAllProblems(): Promise<boolean>
```

```cpp
// C++ å¯¼å‡ºæ¥å£
extern "C" {
  int initDatabase(const char* dbPath);
  int saveProblem(const char* jsonInput);
  const char* loadAllProblems();
  int updateProblemStatus(int id, int status);
  int clearProblems();
  void closeDatabase();
}
```

---

## 4. æ•°æ®æµç¨‹è®¾è®¡

### 4.1 é¡¹ç›®æ£€æŸ¥æµç¨‹

```mermaid
sequenceDiagram
    actor U as ç”¨æˆ·
    participant W as Webview
    participant E as Extension
    participant DB as Database

    U->>W: ç‚¹å‡»"æ£€æŸ¥æ•´ä¸ªé¡¹ç›®"
    W->>E: postMessage(runProjectCheck)
    E->>E: æ‰«ææ–‡ä»¶ â†’ è§£æå‡½æ•° â†’ æ£€æŸ¥æ³¨é‡Š
    E->>DB: ä¿å­˜é—®é¢˜åˆ—è¡¨
    DB-->>E: ä¿å­˜æˆåŠŸ
    E-->>W: è¿”å›æ£€æŸ¥ç»“æœ
    W-->>U: æ˜¾ç¤ºé—®é¢˜åˆ—è¡¨
```

### 4.2 é—®é¢˜è·³è½¬æµç¨‹

```mermaid
sequenceDiagram
    actor U as ç”¨æˆ·
    participant W as Webview
    participant E as Extension
    participant VSC as VS Code Editor

    U->>W: ç‚¹å‡»é—®é¢˜å¡ç‰‡
    W->>E: postMessage(jumpToProblem)
    E->>VSC: æ‰“å¼€æ–‡ä»¶å¹¶å®šä½å…‰æ ‡
    VSC-->>U: æ˜¾ç¤ºç›®æ ‡ä»£ç ä½ç½®
```

### 4.3 è®¾ç½®ä¿å­˜æµç¨‹

```mermaid
sequenceDiagram
    actor U as ç”¨æˆ·
    participant W as Webview
    participant E as Extension

    U->>W: ä¿®æ”¹è®¾ç½®å¹¶ä¿å­˜
    W->>E: postMessage(saveSettings)
    E->>E: æ›´æ–° settings.json
    E-->>W: ä¿å­˜æˆåŠŸ
    E->>E: è‡ªåŠ¨è§¦å‘é‡æ–°æ£€æŸ¥
```

---

## 5. æ•°æ®ç»“æ„è®¾è®¡

### 5.1 æ•°æ®åº“è¡¨ç»“æ„

**problems è¡¨**ï¼š

```sql
CREATE TABLE IF NOT EXISTS problems (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    problem_type INTEGER NOT NULL,
    file_path TEXT NOT NULL,
    function_signature TEXT,
    function_name TEXT NOT NULL,
    line_number INTEGER DEFAULT 1,
    column_number INTEGER DEFAULT 1,
    problem_description TEXT,
    function_snippet TEXT,
    check_timestamp TEXT NOT NULL,
    status INTEGER DEFAULT 0
);
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | é—®é¢˜å”¯ä¸€æ ‡è¯† |
| problem_type | INTEGER | NOT NULL | é—®é¢˜ç±»å‹ (1-5) |
| file_path | TEXT | NOT NULL | æ–‡ä»¶ç›¸å¯¹è·¯å¾„ |
| function_signature | TEXT | | å‡½æ•°ç­¾å |
| function_name | TEXT | NOT NULL | å‡½æ•°å |
| line_number | INTEGER | DEFAULT 1 | å‡½æ•°æ‰€åœ¨è¡Œå· |
| column_number | INTEGER | DEFAULT 1 | å‡½æ•°åæ‰€åœ¨åˆ—å· |
| problem_description | TEXT | | é—®é¢˜æè¿° |
| function_snippet | TEXT | | å‡½æ•°ä»£ç ç‰‡æ®µ |
| check_timestamp | TEXT | NOT NULL | æ£€æŸ¥æ—¶é—´ (ISO 8601) |
| status | INTEGER | DEFAULT 0 | çŠ¶æ€: 0=æ­£å¸¸, 1=å·²å®Œæˆ |

### 5.2 æ ¸å¿ƒç±»å‹å®šä¹‰

```typescript
// å‡½æ•°ä¿¡æ¯
interface FunctionInfo {
  filePath: string;
  functionName: string;
  functionSignature: string;
  comment: string;
  functionContent: string;
  lineNumber: number;
  columnNumber: number;
}

// é—®é¢˜ä¿¡æ¯
interface ProblemInfo {
  problemType: ProblemType;
  filePath: string;
  functionName: string;
  functionSignature: string;
  lineNumber: number;
  columnNumber: number;
  problemDescription: string;
  functionSnippet: string;
}

// æ•°æ®åº“è®°å½•ï¼ˆæ‰©å±• ProblemInfoï¼‰
interface ProblemRecord extends ProblemInfo {
  id: number;
  checkTimestamp: string;
  status: ProblemStatus;
}

// æ£€æŸ¥ç»“æœ
interface CheckAllResult {
  success: boolean;
  totalFiles: number;
  checkedFiles: number;
  skippedFiles: string[];
  problems: ProblemInfo[];
  errorMessage?: string;
}

// ç™½åå•é…ç½®
interface DocDoctorSettings {
  checkMainFunction: boolean;
  functionWhitelist: Record<string, string[]>;
  fileWhitelist: string[];
  returnTypeWhitelist: string[];
}
```

---

## 6. å‰ç«¯ç•Œé¢è®¾è®¡

### 6.1 ç•Œé¢ç»“æ„

ä¾§è¾¹æ é‡‡ç”¨ **Tab é¢æ¿** å¸ƒå±€ï¼ŒåŒ…å«ä¸‰ä¸ªæ ‡ç­¾é¡µï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æ£€æŸ¥]  [è®¾ç½®]  [è°ƒè¯•]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  (å½“å‰é€‰ä¸­æ ‡ç­¾é¡µçš„å†…å®¹)               â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å‡ºæ—¥å¿—                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚  (æ—¥å¿—å†…å®¹åŒºåŸŸ)                      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ£€æŸ¥é¡µè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¸å¿ƒæ£€æŸ¥                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚æ£€æŸ¥å•ä¸ªæ–‡ä»¶ â”‚ â”‚ æ£€æŸ¥æ•´ä¸ªé¡¹ç›®    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é—®é¢˜å±•ç¤ºåŒº                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” æœç´¢æ–‡ä»¶/å‡½æ•°...â”‚ â”‚ æ‰€æœ‰ç±»å‹ â–¼â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ add  @ è¡Œ 25          å‚æ•°ç¼ºå¤± â”‚â”‚
â”‚  â”‚ src/math.c : 5                   â”‚â”‚
â”‚  â”‚ ç¼ºå°‘å‚æ•° "a" çš„è¯´æ˜              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ calculate  @ è¡Œ 42   è¿”å›å€¼ç¼ºå¤±â”‚â”‚
â”‚  â”‚ src/utils.c : 8                  â”‚â”‚
â”‚  â”‚ ç¼ºå°‘ @return è¯´æ˜                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 é—®é¢˜å¡ç‰‡äº¤äº’

- **ç‚¹å‡»å¡ç‰‡**ï¼šè·³è½¬åˆ°å¯¹åº”å‡½æ•°ä½ç½®
- **ç‚¹å‡»æ ‡è®°æŒ‰é’® (â—‹/âœ“)**ï¼šåˆ‡æ¢å®ŒæˆçŠ¶æ€
- **å·²å®Œæˆé—®é¢˜**ï¼šç½®åº•æ˜¾ç¤ºï¼Œé€æ˜åº¦é™ä½

### 6.4 è®¾ç½®é¡µè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æŸ¥è§„åˆ™                            â”‚
â”‚  â˜ æ£€æŸ¥ main å‡½æ•°                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡ä»¶ç™½åå•                          â”‚
â”‚  (æ¯è¡Œä¸€ä¸ªè·¯å¾„ï¼Œæ”¯æŒç›®å½•)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ test/                            â”‚â”‚
â”‚  â”‚ vendor/                          â”‚â”‚
â”‚  â”‚ src/legacy/                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‡½æ•°ç™½åå•                          â”‚
â”‚  (æ¯è¡Œä¸€ä¸ªå‡½æ•°å)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ init                             â”‚â”‚
â”‚  â”‚ cleanup                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿”å›å€¼ç±»å‹ç™½åå•                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ void                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         ä¿å­˜è®¾ç½®                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5 Webview æ¶ˆæ¯ç±»å‹

| æ¶ˆæ¯ç±»å‹ | æ–¹å‘ | è¯´æ˜ |
|---------|------|------|
| `runSingleFileCheck` | Webview â†’ Extension | è§¦å‘å•æ–‡ä»¶æ£€æŸ¥ |
| `runProjectCheck` | Webview â†’ Extension | è§¦å‘é¡¹ç›®æ£€æŸ¥ |
| `jumpToProblem` | Webview â†’ Extension | è·³è½¬åˆ°é—®é¢˜ä½ç½® |
| `saveSettings` | Webview â†’ Extension | ä¿å­˜è®¾ç½® |
| `updateProblemStatus` | Webview â†’ Extension | æ›´æ–°é—®é¢˜çŠ¶æ€ |
| `cancelCheck` | Webview â†’ Extension | å–æ¶ˆæ£€æŸ¥ |
| `requestSettings` | Webview â†’ Extension | è¯·æ±‚å½“å‰è®¾ç½® |
| `projectCheckResult` | Extension â†’ Webview | æ£€æŸ¥ç»“æœ |
| `databaseLoadResult` | Extension â†’ Webview | æ•°æ®åº“è¯»å–ç»“æœ |
| `initSettings` | Extension â†’ Webview | åˆå§‹åŒ–è®¾ç½®æ•°æ® |
| `settingsSaved` | Extension â†’ Webview | è®¾ç½®ä¿å­˜ç»“æœ |
| `log` | Extension â†’ Webview | æ—¥å¿—è¾“å‡º |

---

## 7. æ¥å£è®¾è®¡æ¦‚è¿°

> è¯¦ç»†æ¥å£æ–‡æ¡£è¯·å‚é˜… [æ¥å£æ–‡æ¡£.md](./æ¥å£æ–‡æ¡£.md)

### 7.1 æœåŠ¡å±‚æ¥å£æ¦‚è§ˆ

| æ¨¡å— | ä¸»è¦æ¥å£ | è¯´æ˜ |
|------|---------|------|
| æ–‡ä»¶è§£ææ¨¡å— | `checkFile(uri)` | è§£æå•ä¸ª C/C++ æ–‡ä»¶ |
| å‡½æ•°æ£€æŸ¥æ¨¡å— | `checkFunction(funcInfo)` | æ£€æŸ¥å•ä¸ªå‡½æ•°æ³¨é‡Š |
| æ€»æ£€æŸ¥æ¨¡å— | `checkAllFiles(callback)` | æ£€æŸ¥æ•´ä¸ªå·¥ä½œåŒº |
| ç™½åå•æ¨¡å— | `shouldSkipFunction(func, settings)` | åˆ¤æ–­å‡½æ•°æ˜¯å¦è·³è¿‡ |
| è·³è½¬æ¨¡å— | `jumpToLocation(path, line, col)` | è·³è½¬åˆ°æŒ‡å®šä½ç½® |

### 7.2 æ•°æ®å±‚æ¥å£æ¦‚è§ˆ

| å±‚çº§ | æ¥å£ | è¯´æ˜ |
|------|-----|------|
| TS æ¡¥æ¥å±‚ | `saveProblemToDB()` | å­˜å‚¨é—®é¢˜ |
| TS æ¡¥æ¥å±‚ | `loadProblemsFromDB()` | è¯»å–é—®é¢˜ |
| TS æ¡¥æ¥å±‚ | `updateProblemStatusInDB()` | æ›´æ–°çŠ¶æ€ |
| C++ DLL | `saveProblem()` | SQLite æ’å…¥ |
| C++ DLL | `loadAllProblems()` | SQLite æŸ¥è¯¢ |
| C++ DLL | `updateProblemStatus()` | SQLite æ›´æ–° |

---

## 8. éƒ¨ç½²ä¸æ„å»º

### 8.1 ç›®å½•ç»“æ„

```
doc-doctor/
â”œâ”€â”€ media/                    # å‰ç«¯èµ„æº
â”‚   â”œâ”€â”€ icon.svg              # æ‰©å±•å›¾æ ‡
â”‚   â”œâ”€â”€ sidebar.js            # Webview è„šæœ¬
â”‚   â””â”€â”€ toolkit.js            # UI Toolkit
â”œâ”€â”€ native/                   # C++ åŸç”Ÿæ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ database.cpp      # æ•°æ®åº“å®ç°
â”‚   â”‚   â”œâ”€â”€ database.h        # å¤´æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ main.cpp          # å…¥å£ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ build/                # CMake æ„å»ºäº§ç‰©
â”‚   â”‚   â””â”€â”€ Release/
â”‚   â”‚       â””â”€â”€ doc_doctor_db.dll
â”‚   â”œâ”€â”€ CMakeLists.txt        # CMake é…ç½®
â”‚   â””â”€â”€ CMakePresets.json     # CMake é¢„è®¾
â”œâ”€â”€ src/                      # TypeScript æºç 
â”‚   â”œâ”€â”€ extension.ts          # æ‰©å±•å…¥å£
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ database.ts       # æ•°æ®åº“æ¡¥æ¥
â”‚   â”‚   â”œâ”€â”€ fileCheck.ts      # æ–‡ä»¶è§£æ
â”‚   â”‚   â”œâ”€â”€ fileWhiteList.ts  # ç™½åå•
â”‚   â”‚   â”œâ”€â”€ functionCheck.ts  # å‡½æ•°æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ jumpToLocation.ts # è·³è½¬
â”‚   â”‚   â””â”€â”€ projectCheck.ts   # æ€»æ£€æŸ¥
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ getAddress.ts
â”‚       â””â”€â”€ getDiff.ts
â”œâ”€â”€ out/                      # TypeScript ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ package.json              # npm é…ç½®
â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
â””â”€â”€ README.md
```

### 8.2 æ„å»ºæ­¥éª¤

#### 8.2.1 TypeScript ç¼–è¯‘

```bash
cd doc-doctor
npm install
npm run compile
```

#### 8.2.2 C++ åŠ¨æ€åº“æ„å»º (Windows)

```bash
cd doc-doctor/native

# ä½¿ç”¨ CMake é…ç½®
cmake -B build -S . --preset=default

# ç¼–è¯‘ Release ç‰ˆæœ¬
cmake --build build --config Release
```

**ä¾èµ–é¡¹**ï¼š
- SQLite3 (sqlite3.dll)
- nlohmann/json (å¤´æ–‡ä»¶åº“)

#### 8.2.3 æ‰©å±•æ‰“åŒ…

```bash
npm install -g @vscode/vsce
vsce package
```

### 8.3 è¿è¡Œæ—¶æ–‡ä»¶

æ‰©å±•è¿è¡Œæ—¶ä¼šåœ¨å·¥ä½œåŒºåˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

```
<workspace>/
â””â”€â”€ .doc-doctor/
    â””â”€â”€ problems.db    # SQLite æ•°æ®åº“æ–‡ä»¶
```

### 8.4 é…ç½®é¡¹

åœ¨ `.vscode/settings.json` ä¸­é…ç½®ï¼š

```json
{
  "doc-doctor.checkMainFunction": false,
  "doc-doctor.fileWhitelist": [
    "test/",
    "vendor/"
  ],
  "doc-doctor.functionWhitelist": {
    "src/legacy.c": ["oldFunction"],
    "*": ["globalHelper"]
  },
  "doc-doctor.returnTypeWhitelist": ["void"]
}
```

---

## é™„å½• A: é—®é¢˜ç±»å‹æ˜ å°„

| ç¼–å· | ç±»å‹ | æè¿° | æ£€æŸ¥è§„åˆ™ |
|------|------|------|---------|
| 1 | PARAM_MISSING | å‚æ•°è¯´æ˜ç¼ºå¤± | å‡½æ•°å‚æ•°æ— å¯¹åº” @param |
| 2 | RETURN_MISSING | è¿”å›å€¼è¯´æ˜ç¼ºå¤± | é void å‡½æ•°æ—  @return |
| 3 | BRIEF_MISSING | å‡½æ•°ä½“è¯´æ˜ç¼ºå¤± | æ—  @brief æˆ–åŠŸèƒ½æè¿° |
| 4 | CONTENT_CHANGED | å†…å®¹å˜æ›´è­¦å‘Š | å‡½æ•°ä½“å˜æ›´æœªæ›´æ–°æ³¨é‡Š |
| 5 | SYNTAX_ERROR | è¯­æ³•é”™è¯¯ | æ–‡ä»¶å­˜åœ¨ç¼–è¯‘é”™è¯¯ |

---

## é™„å½• B: Doxygen æ³¨é‡Šè§„èŒƒ

**æ ‡å‡†æ ¼å¼**ï¼š

```c
/**
 * @brief å‡½æ•°åŠŸèƒ½æè¿°
 * @param param1 å‚æ•°1çš„è¯´æ˜
 * @param param2 å‚æ•°2çš„è¯´æ˜
 * @return è¿”å›å€¼çš„è¯´æ˜
 */
int exampleFunction(int param1, char* param2) {
    // å‡½æ•°å®ç°
    return 0;
}
```

**æ£€æŸ¥è¦ç‚¹**ï¼š
- `@brief` æˆ–é¦–è¡Œæè¿°ä¸èƒ½ä¸ºç©º
- æ¯ä¸ªå‚æ•°å¿…é¡»æœ‰å¯¹åº”çš„ `@param` è¯´æ˜
- è¿”å›å€¼é void æ—¶å¿…é¡»æœ‰ `@return` è¯´æ˜
